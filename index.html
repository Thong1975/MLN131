<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gia đình trong thời kỳ quá độ lên CNXH | MLN131</title>
    <meta name="description" content="Tìm hiểu về gia đình Việt Nam trong thời kỳ quá độ lên chủ nghĩa xã hội - Tài liệu học thuật MLN131 Slot 10" />
    
    <!-- Dify Chatbot Configuration -->
    <script>
      window.difyChatbotConfig = {
        token: 'LLQccSwxPqWfOO6K'
      }
    </script>
    
    <!-- Chatbot Styles -->
    <style>
      /* Dify Chatbot Custom Styles */
      /* Đảm bảo chatbot luôn ở trên cùng */
      #dify-chatbot-bubble-button,
      #dify-chatbot-bubble-window {
        pointer-events: auto !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      #dify-chatbot-bubble-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        width: 55px !important;
        height: 55px !important;
        border-radius: 50% !important;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        backdrop-filter: blur(10px) !important;
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        z-index: 9999 !important;
      }
      
      #dify-chatbot-bubble-button:hover {
        transform: scale(1.1) rotate(5deg) !important;
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6) !important;
      }
      
      #dify-chatbot-bubble-window {
        width: 350px !important;
        height: 480px !important;
        border-radius: 16px !important;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px) !important;
        overflow: hidden !important;
        position: fixed !important;
        bottom: 85px !important;
        right: 20px !important;
        z-index: 10000 !important;
        max-height: calc(100vh - 110px) !important;
      }
      
      /* Dify Chatbot Internal Styling - Override tất cả */
      #dify-chatbot-bubble-window,
      #dify-chatbot-bubble-window * {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        box-sizing: border-box !important;
      }
      
      /* Force override cho tất cả div bên trong chatbot */
      #dify-chatbot-bubble-window div {
        transition: all 0.3s ease !important;
      }
      
      /* Specific styling cho message area */
      #dify-chatbot-bubble-window > div:nth-child(2),
      #dify-chatbot-bubble-window > div:nth-child(3) {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
        padding: 15px !important;
      }
      
      /* Header - Thử nhiều selector có thể */
      #dify-chatbot-bubble-window [class*="header"],
      #dify-chatbot-bubble-window [class*="title"],
      #dify-chatbot-bubble-window > div:first-child {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        font-weight: 600 !important;
        padding: 12px 16px !important;
        border-bottom: none !important;
        font-size: 16px !important;
      }
      
      /* Messages container */
      #dify-chatbot-bubble-window [class*="message"],
      #dify-chatbot-bubble-window [class*="chat"],
      #dify-chatbot-bubble-window [class*="conversation"] {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
        padding: 12px !important;
      }
      
      /* Individual message bubbles - User messages */
      #dify-chatbot-bubble-window [class*="user"] div,
      #dify-chatbot-bubble-window [data-role="user"],
      #dify-chatbot-bubble-window .message-user,
      #dify-chatbot-bubble-window div[style*="justify-content: flex-end"] div {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        border-radius: 14px 14px 3px 14px !important;
        padding: 8px 12px !important;
        margin: 6px 0 !important;
        box-shadow: 0 2px 10px rgba(102, 126, 234, 0.25) !important;
        border: none !important;
        font-size: 13px !important;
      }
      
      /* Individual message bubbles - Bot messages */
      #dify-chatbot-bubble-window [class*="assistant"] div,
      #dify-chatbot-bubble-window [class*="bot"] div,
      #dify-chatbot-bubble-window [data-role="assistant"],
      #dify-chatbot-bubble-window .message-bot,
      #dify-chatbot-bubble-window div[style*="justify-content: flex-start"] div {
        background: rgba(255, 255, 255, 0.95) !important;
        color: #2d3748 !important;
        border-radius: 14px 14px 14px 3px !important;
        padding: 8px 12px !important;
        margin: 6px 0 !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06) !important;
        border: 1px solid rgba(102, 126, 234, 0.12) !important;
        font-size: 13px !important;
      }
      
      /* Input area */
      #dify-chatbot-bubble-window [class*="input"],
      #dify-chatbot-bubble-window form,
      #dify-chatbot-bubble-window > div:last-child {
        background: rgba(255, 255, 255, 0.98) !important;
        padding: 12px !important;
        border-top: 1px solid rgba(102, 126, 234, 0.1) !important;
      }
      
      /* Input field */
      #dify-chatbot-bubble-window input[type="text"],
      #dify-chatbot-bubble-window textarea {
        border-radius: 18px !important;
        border: 1px solid rgba(102, 126, 234, 0.2) !important;
        padding: 8px 14px !important;
        font-size: 13px !important;
        transition: all 0.3s ease !important;
        background: white !important;
      }
      
      #dify-chatbot-bubble-window input[type="text"]:focus,
      #dify-chatbot-bubble-window textarea:focus {
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
        outline: none !important;
      }
      
      /* Send button */
      #dify-chatbot-bubble-window button[type="submit"],
      #dify-chatbot-bubble-window [class*="send"],
      #dify-chatbot-bubble-window button:last-child {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        border: none !important;
        border-radius: 50% !important;
        width: 35px !important;
        height: 35px !important;
        color: white !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
      }
      
      #dify-chatbot-bubble-window button[type="submit"]:hover,
      #dify-chatbot-bubble-window [class*="send"]:hover,
      #dify-chatbot-bubble-window button:last-child:hover {
        transform: scale(1.05) !important;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4) !important;
      }
      
      /* Quick reply buttons */
      #dify-chatbot-bubble-window [class*="suggestion"],
      #dify-chatbot-bubble-window [class*="quick"],
      #dify-chatbot-bubble-window button:not([type="submit"]):not(:last-child) {
        background: rgba(102, 126, 234, 0.08) !important;
        border: 1px solid rgba(102, 126, 234, 0.2) !important;
        color: #667eea !important;
        border-radius: 12px !important;
        padding: 5px 10px !important;
        margin: 3px !important;
        transition: all 0.3s ease !important;
        font-size: 12px !important;
      }
      
      #dify-chatbot-bubble-window [class*="suggestion"]:hover,
      #dify-chatbot-bubble-window [class*="quick"]:hover,
      #dify-chatbot-bubble-window button:not([type="submit"]):not(:last-child):hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
      }
      
      /* Scrollbar styling */
      #dify-chatbot-bubble-window *::-webkit-scrollbar {
        width: 6px !important;
      }
      
      #dify-chatbot-bubble-window *::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1) !important;
        border-radius: 3px !important;
      }
      
      #dify-chatbot-bubble-window *::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.3) !important;
        border-radius: 3px !important;
      }
      
      #dify-chatbot-bubble-window *::-webkit-scrollbar-thumb:hover {
        background: rgba(102, 126, 234, 0.5) !important;
      }
      
      /* Animation for opening */
      #dify-chatbot-bubble-window {
        animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      /* Mobile responsive */
      @media (max-width: 480px) {
        #dify-chatbot-bubble-button {
          bottom: 15px !important;
          right: 15px !important;
          width: 50px !important;
          height: 50px !important;
        }
        
        #dify-chatbot-bubble-window {
          width: calc(100vw - 20px) !important;
          height: calc(100vh - 70px) !important;
          right: 10px !important;
          bottom: 70px !important;
          left: 10px !important;
          border-radius: 12px !important;
          max-height: calc(100vh - 70px) !important;
        }
      }
      
      /* Tablet responsive */
      @media (max-width: 768px) and (min-width: 481px) {
        #dify-chatbot-bubble-window {
          width: 320px !important;
          height: 450px !important;
          max-height: calc(100vh - 110px) !important;
        }
      }
      
      /* Backup chatbot styles */
      #backup-chatbot {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
      }
      
      #backup-chatbot-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1C64F2, #3B82F6);
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(28, 100, 242, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        transition: all 0.3s ease;
      }
      
      #backup-chatbot-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(28, 100, 242, 0.4);
      }
      
      #backup-chatbot-window {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
        overflow: hidden;
      }
      
      #backup-chatbot-header {
        background: linear-gradient(135deg, #1C64F2, #3B82F6);
        color: white;
        padding: 15px;
        font-weight: bold;
        text-align: center;
      }
      
      #backup-chatbot-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f8fafc;
      }
      
      #backup-chatbot-input {
        padding: 15px;
        border-top: 1px solid #e2e8f0;
        background: white;
      }
      
      #backup-chatbot-input input {
        width: 100%;
        padding: 10px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        outline: none;
      }
      
      .message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 8px;
        max-width: 80%;
      }
      
      .message.user {
        background: #1C64F2;
        color: white;
        margin-left: auto;
      }
      
      .message.bot {
        background: white;
        border: 1px solid #e2e8f0;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Backup Chatbot HTML -->
    <div id="backup-chatbot" style="display: none;">
      <button id="backup-chatbot-button" onclick="toggleBackupChat()">💬</button>
      <div id="backup-chatbot-window">
        <div id="backup-chatbot-header">
          Trợ lý AI - MLN131
          <button onclick="toggleBackupChat()" style="float: right; background: none; border: none; color: white; cursor: pointer;">✕</button>
        </div>
        <div id="backup-chatbot-messages">
          <div class="message bot">
            Xin chào! Tôi là trợ lý AI cho môn MLN131. Tôi có thể giúp bạn tìm hiểu về gia đình Việt Nam trong thời kỳ quá độ lên chủ nghĩa xã hội. Bạn có câu hỏi gì không?
          </div>
        </div>
        <div id="backup-chatbot-input">
          <input type="text" placeholder="Nhập câu hỏi của bạn..." onkeypress="handleBackupChatInput(event)">
        </div>
      </div>
    </div>
    
    <!-- Dify Chatbot Script - Thử URL khác -->
    <script>
      (function() {
        // Thử load từ nhiều nguồn khác nhau
        const scripts = [
          'https://udify.app/embed.min.js',
          'https://dify.ai/embed.min.js',
          'https://cloud.dify.ai/embed.min.js'
        ];
        
        let currentScript = 0;
        
        function loadScript() {
          if (currentScript >= scripts.length) {
            console.error('Không thể tải Dify chatbot từ bất kỳ nguồn nào');
            return;
          }
          
          const script = document.createElement('script');
          script.src = scripts[currentScript];
          script.id = 'LLQccSwxPqWfOO6K';
          script.defer = true;
          
          script.onload = function() {
            console.log('Dify chatbot đã tải thành công từ:', scripts[currentScript]);
          };
          
          script.onerror = function() {
            console.warn('Không thể tải từ:', scripts[currentScript]);
            currentScript++;
            loadScript();
          };
          
          document.body.appendChild(script);
        }
        
        // Bắt đầu load script
        loadScript();
        
        // Nếu sau 10 giây vẫn không load được Dify, hiển thị backup chatbot
        setTimeout(function() {
          if (!document.getElementById('dify-chatbot-bubble-button')) {
            console.log('Chuyển sang backup chatbot');
            document.getElementById('backup-chatbot').style.display = 'block';
          } else {
            // Apply custom styles to Dify chatbot
            applyChatbotStyles();
          }
        }, 10000);
        
        // Function to apply custom styles
        function applyChatbotStyles() {
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.type === 'childList') {
                // Apply styles to new elements
                const chatWindow = document.getElementById('dify-chatbot-bubble-window');
                if (chatWindow) {
                  // Force apply styles to all elements inside chatbot
                  const allElements = chatWindow.querySelectorAll('*');
                  allElements.forEach(function(el) {
                    // Apply font family
                    el.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    
                    // Style message bubbles
                    if (el.textContent && el.textContent.length > 0) {
                      const parent = el.parentElement;
                      if (parent && parent.style.justifyContent === 'flex-end') {
                        // User message
                        el.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        el.style.color = 'white';
                        el.style.borderRadius = '18px 18px 4px 18px';
                        el.style.padding = '10px 14px';
                        el.style.boxShadow = '0 3px 12px rgba(102, 126, 234, 0.3)';
                      } else if (parent && parent.style.justifyContent === 'flex-start') {
                        // Bot message
                        el.style.background = 'rgba(255, 255, 255, 0.95)';
                        el.style.color = '#2d3748';
                        el.style.borderRadius = '18px 18px 18px 4px';
                        el.style.padding = '10px 14px';
                        el.style.boxShadow = '0 3px 12px rgba(0, 0, 0, 0.08)';
                        el.style.border = '1px solid rgba(102, 126, 234, 0.15)';
                      }
                    }
                  });
                }
              }
            });
          });
          
          // Start observing
          observer.observe(document.body, {
            childList: true,
            subtree: true
          });
        }
      })();
      
      // Backup chatbot functions
      function toggleBackupChat() {
        const window = document.getElementById('backup-chatbot-window');
        window.style.display = window.style.display === 'flex' ? 'none' : 'flex';
      }
      
      function handleBackupChatInput(event) {
        if (event.key === 'Enter') {
          const input = event.target;
          const message = input.value.trim();
          if (message) {
            addBackupMessage(message, 'user');
            input.value = '';
            
            // Simulate bot response
            setTimeout(() => {
              const responses = [
                'Cảm ơn bạn đã hỏi về MLN131! Đây là một chủ đề rất thú vị về gia đình Việt Nam.',
                'Gia đình trong thời kỳ quá độ lên CNXH có nhiều thay đổi quan trọng. Bạn muốn tìm hiểu khía cạnh nào cụ thể?',
                'Tôi hiểu câu hỏi của bạn. Hãy tham khảo tài liệu MLN131 để có thông tin chi tiết hơn.',
                'Đây là một câu hỏi hay! Gia đình Việt Nam đã trải qua nhiều biến đổi trong quá trình phát triển.',
                'Bạn có thể tìm thêm thông tin trong phần tài liệu học thuật trên trang web này.'
              ];
              const randomResponse = responses[Math.floor(Math.random() * responses.length)];
              addBackupMessage(randomResponse, 'bot');
            }, 1000);
          }
        }
      }
      
      function addBackupMessage(text, sender) {
        const messagesContainer = document.getElementById('backup-chatbot-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        messageDiv.textContent = text;
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
    </script>
  </body>
</html>


